<ng-template #addEventModal let-modal>
  <div class="modal-body">
    <form
      class="ps-3 pe-3"
      [formGroup]="addEventForm"
      (ngSubmit)="createEvent()"
    >
      <div class="mb-2">
        <label class="form-label">Event Name</label>
        <input
          class="form-control"
          type="text"
          id="name"
          formControlName="name"
          placeholder="Event Name"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Title</label>
        <input
          class="form-control"
          type="text"
          id="title"
          formControlName="title"
          placeholder="Event Title"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Venue Date</label>

        <input
          class="form-control"
          id="example-date"
          type="date"
          name="date"
          formControlName="venue_date"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Venue Time</label>
        <input
          class="form-control"
          type="time"
          id="venue_time"
          formControlName="venue_time"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea
          class="form-control"
          id="description"
          formControlName="description"
          placeholder="Description"
        ></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label">Status</label>
        <select class="form-control" formControlName="status">
          <option value="" disabled selected>Select Status</option>
          <option value="true">Active</option>
          <option value="false">Inactive</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Course</label>

        <select class="form-control" formControlName="course_id">
          <option value="" disabled>Select Course</option>
          <option *ngFor="let course of courses" [value]="course.id">
            {{ course.name }}
          </option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Max Users</label>
        <input
          class="form-control"
          type="number"
          id="user_joined_max"
          formControlName="user_joined_max"
          placeholder="Max Users"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Location</label>
        <input
          class="form-control"
          type="text"
          id="location"
          formControlName="location"
          placeholder="Location"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Conductor Name</label>
        <input
          class="form-control"
          type="text"
          id="conductor_name"
          formControlName="conductor_name"
          placeholder="Conductor Name"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Conductor Phone</label>
        <input
          class="form-control"
          type="text"
          id="conductor_phone"
          formControlName="conductor_phone"
          placeholder="Conductor Phone"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Upload Image</label>
        <ngx-dropzone
          [multiple]="false"
          (change)="onSelectImage($event)"
          class="dropzone"
        >
          <ngx-dropzone-label>
            <i class="h1 text-muted dripicons-cloud-upload"></i>
            <h3>Drop files here or click to upload.</h3>
          </ngx-dropzone-label>
        </ngx-dropzone>

        <div class="dropzone-previews mt-3">
          <div class="card mt-1 mb-0 shadow-none border" *ngIf="files">
            <div class="p-2">
              <div class="row align-items-center">
                <div class="col-auto">
                  <img
                    class="avatar-sm rounded bg-light"
                    [alt]="files.name"
                    [src]="getPreviewUrlImg(files)"
                  />
                </div>
                <div class="col ps-0">
                  <a href="javascript:void(0);" class="text-muted fw-bold">{{
                    files.name
                  }}</a>
                  <p class="mb-0">{{ getSize(files) }}</p>
                </div>
                <div class="col-auto">
                  <a
                    href="javascript:void(0)"
                    class="btn btn-link btn-lg text-muted"
                    (click)="onRemoveFile($event)"
                  >
                    <i class="dripicons-cross"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-3 text-center">
        <button class="btn btn-primary" type="submit">Create Event</button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #editEventModal let-modal>
  <div class="modal-body">
    <form
      class="ps-3 pe-3"
      [formGroup]="editEventForm"
      (ngSubmit)="updateEvent()"
    >
      <div class="mb-2">
        <label class="form-label">Event Name</label>
        <input
          class="form-control"
          type="text"
          id="name"
          formControlName="name"
          placeholder="Event Name"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Title</label>
        <input
          class="form-control"
          type="text"
          id="title"
          formControlName="title"
          placeholder="Event Title"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Venue Date</label>

        <input
          class="form-control"
          id="example-date"
          type="date"
          name="date"
          formControlName="venue_date"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Venue Time</label>
        <input
          class="form-control"
          type="time"
          id="venue_time"
          formControlName="venue_time"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea
          class="form-control"
          id="description"
          formControlName="description"
          placeholder="Description"
        ></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label">Status</label>
        <select class="form-control" formControlName="status">
          <option value="" disabled selected>Select Status</option>
          <option value="true">Active</option>
          <option value="false">Inactive</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Course</label>

        <select class="form-control" formControlName="course_id">
          <option value="" disabled>Select Course</option>
          <option *ngFor="let course of courses" [value]="course.id">
            {{ course.name }}
          </option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Max Users</label>
        <input
          class="form-control"
          type="number"
          id="user_joined_max"
          formControlName="user_joined_max"
          placeholder="Max Users"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Location</label>
        <input
          class="form-control"
          type="text"
          id="location"
          formControlName="location"
          placeholder="Location"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Conductor Name</label>
        <input
          class="form-control"
          type="text"
          id="conductor_name"
          formControlName="conductor_name"
          placeholder="Conductor Name"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Conductor Phone</label>
        <input
          class="form-control"
          type="text"
          id="conductor_phone"
          formControlName="conductor_phone"
          placeholder="Conductor Phone"
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Upload Image</label>
        <ngx-dropzone
          [multiple]="false"
          (change)="onSelectImage($event)"
          class="dropzone"
        >
          <ngx-dropzone-label>
            <i class="h1 text-muted dripicons-cloud-upload"></i>
            <h3>Drop files here or click to upload.</h3>
          </ngx-dropzone-label>
        </ngx-dropzone>

        <div class="dropzone-previews mt-3">
          <div class="card mt-1 mb-0 shadow-none border" *ngIf="files">
            <div class="p-2">
              <div class="row align-items-center">
                <div class="col-auto">
                  <img
                    class="avatar-sm rounded bg-light"
                    [alt]="files.name"
                    [src]="getPreviewUrlImg(files)"
                  />
                </div>
                <div class="col ps-0">
                  <a href="javascript:void(0);" class="text-muted fw-bold">{{
                    files.name
                  }}</a>
                  <p class="mb-0">{{ getSize(files) }}</p>
                </div>
                <div class="col-auto">
                  <a
                    href="javascript:void(0)"
                    class="btn btn-link btn-lg text-muted"
                    (click)="onRemoveFile($event)"
                  >
                    <i class="dripicons-cross"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-3 text-center">
        <button class="btn btn-primary" type="submit">Update Event</button>
      </div>
    </form>
  </div>
</ng-template>

<!-- page title -->
<h4>Events</h4>

<div class="col-xl-12">
  <div class="text-xl-end mt-xl-0 mt-2">
    <button
      type="button"
      class="btn btn-danger mb-2 me-2"
      (click)="open(addEventModal)"
    >
      Add New Event
    </button>
    <!-- (click)="(addCourseModalopen)" -->
    <!-- <button type="button" class="btn btn-light mb-2">Export</button> -->
  </div>
</div>
<br />
<div class="row">
  <!-- Loop through course details -->
  <div class="col-lg-6" *ngFor="let event of events">
    <div class="card border border-dark mb-3 d-flex flex-column" style="min-height: 300px;">

      <!-- Headline -->
      <div class="d-flex align-items-center justify-content-between p-2">
        <h5 class="card-title text-center flex-grow-1 mt-2">
          {{ event?.name }}
        </h5>
        <button
          class="btn btn-danger ms-3 me-2 mt-2"
          (click)="openEdit(editEventModal, event)"
        >
          Edit
        </button>
      </div>

      <!-- Media Section -->
      <div class="row g-0 flex-grow-1">
        <div class="col-md-12">
          <div class="card-body d-flex flex-column">
            <div class="media-container mb-3">
              <!-- Check if event has an image -->
              <ng-container *ngIf="event.img; else noFiles">
                <img [src]="event.img" class="image-frame" alt="Event Image" />
              </ng-container>

              <!-- Fallback when no image is available -->
              <ng-template #noFiles>
                <p class="text-muted text-center">No files uploaded</p>
              </ng-template>
            </div>
          </div>
        </div>
      </div>

      <!-- Paragraph -->
      <div
        class="row g-0 align-items-center justify-content-center text-center p-2"
      >
        <p class="card-title">{{ event?.content }}</p>
      </div>

      <div class="d-flex align-items-center justify-content-between p-2">
        <!-- Display event time -->
        <button class="btn btn-danger ms-3 me-2 mt-2">
          {{ convertTo12HourFormat(event.time) }} <!-- Format event.time as AM/PM -->
        </button>
        
      
        <!-- Display formatted date -->
        <button class="btn btn-danger ms-3 me-2 mt-2">
          {{ event.date | date:'MMMM dd, yyyy' }}
        </button>
      
     
      </div>
      
    </div>
  </div>
</div>
